package io.github.tscholze.kotlog.templates.images

import io.github.tscholze.kotlog.models.PostConfiguration
import java.awt.Color
import java.awt.Font
import java.awt.FontMetrics
import java.awt.image.BufferedImage
import java.io.ByteArrayInputStream
import java.io.File
import java.util.*
import javax.imageio.ImageIO


class SocialMediaPreviewImage {

    companion object {
        // MARK: - Private properties -

        private val BACKGROUND_IMAGE: BufferedImage = ImageIO.read(
            ByteArrayInputStream(
                Base64.getDecoder().decode(
                    "iVBORw0KGgoAAAANSUhEUgAABQAAAAKACAYAAADD89WhAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAADmFSURBVHgB7d15nNZlvfj/N4IKCAiCgGi4Ix3cFQU3PMelUssl9+W4m2luqZmmVurRNM3KTC2XQ7njkuZ6XJIwl0AMkFw4prggIsi+L/5+18dvJ5l7uO8ZmIG5r3k+H495WJ/7cw8z92f+ej2u63q3+Oz/FwAAAABAllYKAAAAACBbAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMtYqqkCLFi0CAAAAAJq6zz77LJoaKwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQsaoYAlKbpnigIgAAAADNR7UMrrUCEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZaxUAAAAANCmfffZZTJkyJSZMmBCjR4+Ot956KyZOnBjjx48v/ptemzVrVvE1b968WLRoUfG+Vq1axcorrxxt2rSJDh06RLt27aJTp07RpUuXWGuttaJXr16x2WabRY8ePaJ9+/ZB89Dis/QX1cS1aNGi5FoV/NgAAAAAFS1YsKCIeq+//nqMGDGiCH5jxoyJTz75JKZOndrgDSR1lrZt20b37t1jk002iT59+sQWW2wRvXv3Lq7V1mGoXbU0KwEQAAAAYDlbuHBhvPrqqzF48OB48skn4+233445c+bEitS6devYeOON4xvf+Eb069eviIItW7YMlkwAbEACIAAAAFDt0nbdoUOHxoMPPhhPP/10TJ48OZqyjh07FiHwsMMOi1133bXYXsziBMAGJAACAAAA1Wju3LkxatSoeOihh+LZZ5+NsWPHVmXTSGcG/sd//EccfPDBsfXWW9sm/P8IgA1IAAQAAACqSTrXL630e+CBB+L555//vyEd1S41ml122SUOOuig+MpXvlKcJdicCYANSAAEAAAAqsGkSZPij3/8Y1x11VXFAI+crb766nHGGWfEN7/5zWLKcHMkADYgARAAAABoyj788MO49dZbixV/EyZMiOakW7dusd9++8Upp5zS7EKgANiABEAAAACgKUpbfW+77bb4zW9+E+PGjYvGktpI+/bti7P4UnBbY401iv+ftuCussoq/zegY/78+TFv3rxi4MiUKVNi+vTpMXHixCJKfvLJJ43aU9LPdsIJJ8QRRxwR7dq1i+ZAAGxAAiAAAADQlKQuMXjw4DjrrLMadMXfP0Pf+uuvH3369Imtttoqtt122/jSl74Ubdq0iWUxe/bseOedd+Ktt96Kl156KUaMGBHvvvtuTJs2LRrSmmuuWWyB3mOPPbIfFiIANiABEAAAAGgqhg8fHtdcc00899xzsaxS80gr+jbffPPo379/bLfddkX8S+frLQ8p/qUo+Ne//jVeeOGFGDZsWEyePLlBusuAAQPi/PPPj8022yxyJQA2IAEQAAAAWNFSi7jllluK1W0zZ86MZdGhQ4diiu4OO+wQu+22W3Tu3DmagjTE5OWXXy7OMvzLX/6yzKsD01bgc889Nw4//PAsJwYLgA1IAAQAAABWpDfffLMIWa+88kosrdatWxer4Y4++ujYa6+9YtVVV42mLJ0l+Kc//SluuOGG4vdetGhRLK20jfkXv/hFrLfeepETAbABCYAAAADAinL33XfHZZddVmyNXRpp5dt//ud/xje/+c348pe/vMzn4o0fP74YOPLxxx/H1KlTY+7cucXwj2TllVcuwmLHjh2ja9eusc466xT/XVZvv/12DBo0qFgBmQaMLI30OVx66aVxyCGHZHM2oADYgARAAAAAYHlLE3QvueSSuPPOO2NpdOnSpVjtd+yxx0anTp3q9d4U9UaOHBmjRo2KsWPHxpgxY4qz+tLAkTlz5tTre6XhIWmIyFprrVWcL/hv//Zv0atXr2LISH235aZ///bbby9i4HvvvRf1tdJKKxWfxznnnFNsg652AmADEgABAACA5SmtsPvWt75VDPyor3Se31FHHRUnn3xyMdG3LlLwe/3114vpvEOGDCnO3/vnqr7GklYLpjMId9lll+jXr1+xOrGu25JTHL3pppvi5ptvLv53faWt0AMHDiwGoFQzAbABCYAAAADA8pIm4p522mnxwQcf1Ot9rVq1im9/+9vFdt8ePXpUvH/hwoXxzDPPxCOPPFIEv7S1d0Xq3r17EQT33nvv2HPPPYvVepWkoSG/+c1v4sYbb4wFCxZEfaR/L50vmCYfVysBsAEJgAAAAMDy8OCDD8Z5551X7ym/aQXd5ZdfHptssknFe9NW3rvuuivuu+++4hy/pmijjTYqphR//etfL1brVTJ69Oi4+OKLi3han2EhaUrwT37yk9h///2jGgmADUgABAAAABrbHXfcEd///vfrFbDSdt+0WvD4448vu2IurY5LcSxtmX3qqaeWaaLu8pR+p913373YzrzNNtsUqxyXJLWaNCTk5z//eb0GpqTuk+JpWjlZbQTABiQAAgAAAI3pZz/7WVxzzTX1es/OO+8cV199dTFpt5yHHnoofv3rX8cbb7xR722yTcmmm24aZ511Vnz1q18te99HH30UZ555Zjz//PNRH9/97nfj7LPPjmoiADYgARAAAABoLCniXXvttXW+P3WK888/P0499dSy9w0ePDh++ctfFoM9ctK/f//id991111rbTbJvHnzinMBr7vuupg1a1bUVQqMaUJwtRAAG5AACAAAADSGtOovrf6rqzS19vrrry8i2JK89957cdlll8Xjjz9eNVt96yu1mr322isuueSSYpjHkrzyyitx3HHHxcSJE6OuLrjggopxtakQABuQAAgAAAA0tIEDBxaxqa4233zzuOmmm6Jnz55LvCdNtU3bfT/99NNoDtIQj7RtN52B2LJly1rvSdOUTzrppBgxYkTU1ZVXXhlHHnlkNHUCYAMSAAEAAICGlKb9puEdde0LBx10UFxxxRXRpk2bWl9/++2344wzzohXX301mqPtt98+fvrTn8aGG25Y6+uTJk2KSy+9NAYNGhR1kYaPpO3TTX06sADYgARAAAAAoKGkabxHHXVUzJgxo073p+m0aUrtks67S9OD04q1FLmas7Zt28YPf/jDJa7cSy3n4osvjltvvTXqYpVVVol77rkntttuu2iqBMAGJAACAAAADWHChAnF2XVpUm0lqUecfPLJceGFF9b6eproe/rpp8fDDz+sU/w/6TM75JBDiiDaqlWrWu9JKwHTgJC6WHvtteMPf/hD9OjRI5oiAbABCYAAAADAspo+fXrsvffexXbdSlKLSOEvBcDapEEfKf4NHTo0KJXOS0zDUjbYYIOS1+bPnx+33HJLEQLrok+fPnHfffdFhw4doqmplma1UgAAAABkLkWZdEZdXeJfksJfGmxRm7/97W/FKjfxb8lGjhwZRxxxRPHfmlZeeeXi811SXK1p9OjRRSy0GGzpCYAAAABA9tJZcrfddlud7k3hL63+S6GqppdeeqkIW2kFIOWlz2i//fZb4vTfiy66KI4++uioizvvvLN4hiwdW4ABAACArL377ruxxx57xKxZsyrem6b9XnvttbW2iGeeeSaOO+644uw/6q59+/Zx1VVXxTe+8Y2S11LfOeuss+o0HbhTp07xwAMPRK9evaKpsAUYAAAAYAWbOXNmnHHGGXWKf+ncurTyr7aokwZ9nHPOOeLfUkhnL6bpwCmg1pQ+6yuuuKL47CuZPHly8QwsCqs/ARAAAADI1l133RXDhg2reF+XLl3it7/9bfHfmtIW1vPOO6+YIMzSSZ9dWj2ZtlDX1KZNm7jhhhuia9euFb/PK6+8UgwQoX4EQAAAACBLo0aNKraeVtK2bdsiKq2zzjolr6UhFgcccEBMmzYtWDZp9eQJJ5wQL7/8cslr6623Xvz6178unkUlaZiLASz1IwACAAAA2UnbRNPW0rQFuJLTTjsttt1225Lr77zzTjGpds6cOUHDSNt405l/tQ1R6d+/f5x55pkVv8eMGTOKcxptBa47ARAAAADIzlNPPRWDBw+ueN9OO+1URL6a0mq1U045JcaOHRs0rPSZnn766bWep3jqqadG3759K36P9Gzr8nz5nCnAAAAAQFbSCrEU9j755JOy96Wpsv/zP/8TPXr0KHnt7LPPjrvvvjtoPGkqcDr7r6YPPvgg9tprr5g0aVLZ96czA9NW4FatWsWKYgowAAAAwApwxx13VIx/K620UrHdtLb4d/vtt8c999wTNK40WTl91jWlsxjTCsFK0mCR2267LajMCkAAAAAgGxMnToyvfe1rMW7cuLL39evXL+67776S5vD2228X76/L2YEsu86dO8eDDz4YG2644WLXFy1aFAcddFCtU4O/aO21144//OEPtYbc5cEKQAAAAIDlLE2SrRT/0pbRH//4xyXxZuHChfG9731P/FuO0jbfM844o+R6WqF5+eWXV9ze++GHH8bNN98clCcAAgAAAFlIMSmtJqskDf3YdNNNS67fcsstFVecNaR27drF5ptvHscff3ytU4ibi1dffbXWswA32WSTWge01JRWAFY6L7C5EwABAACALKSVYOlcuHJSdDvppJNKrn/88cdx9dVXR2Pr3r17HHzwwfGTn/wkHn/88eLrkksuiXXXXTeas7Ry87333iu5fvTRR0eXLl3Kvjc9uz/+8Y/BkgmAAAAAQNWbNWtWDBw4sOJ93/3ud4tz574ondl28cUXN9rW39atW8cVV1wRL7/8crzyyitx7bXXxlFHHRUbbLBB8LlPP/00LrvsspLr6Wy/b33rWxXff9VVV8WCBQuC2gmAAAAAQNV78sknY+rUqWXv6dmzZxx++OEl15977rl47LHHorGkALj//vsX021ZsrQacvDgwSXXUwCstAowPfu6bP9urgRAAAAAoKqlibGDBg2qeF+aKtu+ffuS67/61a+K78GKlZ7BddddV3K9ZcuWxVbgSlIAnDt3blBKAAQAAACqWhoiMWTIkLL3tG3bNo488siS60888cRyHfxBeS+++GKxIrOmY489tniG5fz5z3+OUaNGBaUEQAAAAKCqpdV/lVbwpUm7Xbt2XexaOjPuZz/7WdC0pPMSa57n16lTp+IZlpPOcrzvvvuCUgIgAAAAULVSKHrmmWfK3rPSSisV239rSgM5Ro8eHTQtr7/+ejEwpaZ99923OE+xnLQSNA2EYXECIAAAAFC10nbRcePGlb1nm222iQ033LDk+o033hg0PQsXLoxbbrml5Hrv3r1js802K/vesWPHxtChQ4PFCYAAAABA1br77rsr3nPKKaeUXEtnxT399NNB0/TUU0/FO++8s9i1Fi1axDHHHFP2fWkbsGnApVoFAAAAQBVKK8XS0IhyOnToEAMGDCi5/sc//tHk3xo6duxYrLL70pe+FGussUax3bZVq1bF5zR//vyYOXNmTJs2LSZNmhQTJkwoVtula40h/Zt33XVXXHDBBYtd/9rXvlY80/RzLEkKu+lvI00P5nMCIAAAAFCVRo4cGVOmTCl7z4477hirrrrqYtdSXHryySejIaThFGkrcbnYtPLKK0ebNm3Kfp/vfOc7cdhhh0V9PPTQQ/H73/8+llZaUbfxxhvHV77yldhnn32iT58+xbW6SqvtxowZE8OHD4+HH344Bg8eHA3p/vvvj+9///vFGY7/lJ7lnnvuWXbYx+TJk4sVnltuuWXwOQEQAAAAqEovvPBCxXsOOOCAkmtpe+n//u//RkNIq+T69etXrJRbFr169Yr6GjFiRCyt7bbbLs4+++xl+tlTLEw/d/pKn0NDB8Dx48cXzyoFyi/aYYcdKk77TWdDCoD/4gxAAAAAoCqlbbzlpG2s22+/fcn1Rx99NJqrFO3Sqrp77703dtppp2UOl43tkUceKbm22267Rffu3cu+b9iwYcWEaD4nAAIAAABVJ60OS9tPy9l2222jc+fOi12bO3du/OUvf4nmaLXVViu2K5922mnFtuRqkFZ5pmf2RV26dInNN9+87Pv++te/xsSJE4PPCYAAAABA1Xn99ddjzpw5Ze9JK9xqe1+Kh81NOkfvnHPOKc76qybpWaVnVlNtz/aL0nCSN954I/icMwABAACAqlOX8++22WabkmvpTLnmqH///nHcccdVvC9Nz02f7d/+9rdiwEoamJIGb7Rr1y7WXHPNYuvteuutV6ysrM/AkGWRzhaseZ7f1ltvXfz7aRDJkqTfYddddw0EQAAAAKAKjR49uuzrHTp0iPXXX7/kekMPqpgxY0bccccdi02qrSkNyNh3331jlVVWWeI9f/7zn2Ps2LFRH6+++mqd7z3mmGMqnveXzs276KKLiunKlaQQmFbhpbCYQmsKhY0lTTs+44wzFru2wQYbRPv27WPatGlLfF+lv5HmpMVn5VJpE1FbUa6CHxsAAABoJAMGDCg7yXeLLbaIxx57bLFraVtonz59Yv78+bE8dezYMV566aUiWC3J6aefHvfff380hjZt2sTQoUOjU6dOS7zn448/jt133z0+/fTTqK+WLVsWA1c++eSTaAypC6VnnULqF+21115lV4Km6cTPPvtso65UrJZm5QxAAAAAoKpMnz49Pvroo7L31DYk4u9///tyj39NQVqtVy7+JWkF4tLEvyRtG26s+JekoPbaa6+VXN90003Lvm/ChAnFNmYEQAAAAKDKjBs3LmbNmlX2nn79+pVcqzQ1OFdpO3QlNVfXNTW1bUuu7YzHL5o6dWoRAREAAQAAgCqTVoNV2maZtn/W1FzPhJs3b17Fe/r27VusFGyqajsfseZgkJrS34hzAD8nAAIAAABV5a233ir7ejqXrbYBIO+88040R2kl3Ny5c8vek+LfPffcE/vss0/ZgSYrSm2rN3v27FnxfL9KfyvNhQAIAAAAVJW0BbicNddcsxh8UVOlcwNzlc7nS0M+Ktloo43ixhtvjEGDBsX+++8fq6++ejQV7777bsm19IzLDVZJGvNswmoiAAIAAABVZeLEiWVf79q1a63X33///WiO0uCTIUOG1OnetKIunZ/4q1/9KoYPHx533nln7LfffsUk4xVpSfF27bXXLvu+uoTP5kAABAAAAKrK5MmTy77euXPnkmtpGMTs2bOjubr55psrhtOa0mCQAQMGxPXXX18M4XjkkUfivPPOi969ey/3bcLpHMPaImC3bt3Kvq++v3OuBEAAAACgqsyYMaPs67VNvf3ggw+iOUtn4V1wwQWxtFq2bBlbbbVVnH766fHYY4/F7373u9h9992XawisLQCuscYaZd8zZcqUQAAEAAAAqsy0adPKvl7bdtW0ArC5e/TRR+P888+P6dOnx7JYddVV49///d9j4MCBce+998amm24ay0Ntz7Bdu3Zl3zNr1qxAAAQAAACqTKWos9pqq5Vcq7RtuLlIK/cOPPDAGDZsWDSE/v37x/333x8nnnhiNLbaVvO1bdu27HsEwM8JgAAAAEBVWbBgQdnXV1lllZJrc+fODT732muvFVN+jz766Hj66aeX+bNJq/B+9KMfxT777BONac6cOSXX0mrEctLZgQiAAAAAQJWpFADTeXX1fU9zs2jRoiL+pQi47bbbxuWXXx4vvvjiMsXAq6++OjbaaKNoLLU9w9qe9Rel3xMBEAAAAMhMixYtgrr79NNPi0m/aWtwnz594tBDD40777yz3ttn27dvH0cddVQsT5999llQmQAIAAAAVJVKk2cXLlxYcq1Vq1ZBZbNnz44hQ4bEueeeG1tvvXWccsop8cILL9Q5tKUzARsrwNb2DGt71l9UaYVgcyEAAgAAAFWltjP+vqi2baytW7eOpqwprlpM04IfeuihOOigg+KYY46J999/v+J71llnnejQoUM0htqeYaUz/ir9rTQXAiAAAABQVSpNfp05c2bJtdVXXz1WlLR6rtIKujZt2kRTls4LTBFw/vz5Ze9Lv0djxdaOHTuWXKvtWdf8eRAAAQAAgCpTKQDOmDGj5Fq3bt1iRUnDKyptVd1www2jqXvjjTdizJgxZe9J27MbazVj165dS65NmTKl7HsaazVitREAAQAAgKpS20qwL0pDLWpaa621YkVJW5IrDdRIk3hXXnnlaOoqxb20JXfOnDnRGNL24prSNuVy2rVrFwiAAAAAQJXp0qVL2dcnTJhQcq179+4r7Dy4tAJw3LhxZe/ZYostYscdd4zGsO6668ZZZ50VX/rSl2JZbLzxxtG7d++y96TPfurUqdHQ0qrPNddcs+T6xIkTy76vU6dOgQAIAAAAVJlK23k//PDDkmtp5dqKXAX497//vezraevs7373uzj++OOjc+fOtd6TAmaPHj1iwIABceqpp8a+++4bdZEi2DnnnBPPP/98PProo3HeeefFrrvuWgS1ukzJXXXVVeOrX/1q/P73v6+4ArA+E4PrI63+q+3f/vjjj8u+r1Isbi7MwAYAAACqSm0rwb4obQudPXt2yQCI9dZbL8aOHRsrwrPPPhtHH3102XtSjLvkkkvixBNPLM7bS3ErrR5MAS5FwbSCL/0O//y9brzxxmJKb121atUqttxyy+IrmTx5crz11lvx3nvvxUcffVT8e+n8xLSFNwXJNDglBce+ffvG9ttvX1yr5N57743GUFu8Tc+40grA9PMjAAIAAABVplevXmVfTyvQ3n///ZL7Ntpooxg8eHCsCGmK7ogRI4qtvpWk0Les23XrIq0MTGEvfTWE3/72tzF06NBoDCl81vTOO+9UXG1Y6W+lubAFGAAAAKgqffr0qbgV9ZVXXim5VltEWp6uuOKKyNVf/vKXuPbaa6Ox1BZO33zzzbLvSX8jm266aSAAAgAAAFUmbQFO21PLGT58eMm1zTffPFakIUOGxHXXXReLFi2KnKTf64QTTmiU4R//tMEGG5Rce/nll8u+Jw0OsQX4cwIgAAAAUFXS1tWuXbuWvWf06NEl19JqsJVXXjlWpCuvvDJ++MMfxvz586PaTZo0Kc4///w49NBDY9q0adFY0jNLqz5rGjlyZNn3pcnP7du3DwRAAAAAoMqkrZ3pPL9y0vlwNVektW7dOnbcccdYkdKZdbfeemsxhff222+PefPmxdJIqwjrGt3ScI90BuHMmTOjIQwbNqyYJLz77rsXk4sbWwq3aTXfF6Vnm55xOZtssknwOUNAAAAAgKqTVoQ99thjS3w9TQL+xz/+EVtttdVi13feeed47rnnYkV79913i4j285//vJiym37OdEZhWtnYrl27YvJvinxz586NKVOmFBEvDTb54IMPignBr732Wp2DXprwmyYQpynAaSttz549Y91114111lknunXrFh07diz+zRTZUiRN04hTZE3TgFNkHDduXDE9OX2eL7zwQvFzLE8pltaU4l+lAFrbqsHmSgAEAAAAqk6labpppV06B7BmAOzXr180JSnOPfzww8VXY1uwYEG89dZbxVc12WOPPUqu1TbkpaYtt9wy+JwtwAAAAEDV+fKXv1ysVivn+eefr/V96Ww4qkN6Vr179y65nrY0l9O5c+da39dcCYAAAABA1enSpUtsuOGGZe9JQyImTpy42LW0tXaHHXYIqkM6szE9sy9Kw0dqi7tflCY+C73/IgACAAAAVSedZ/eVr3yl7D3jx4+PZ599tuT617/+9aA67L333iXXXnrppeJ8xHJE3sUJgAAAAEBV2m233Srek4ZW1JSm16bhFzRtG2+8ca3n/z3wwAMV39u/f//gXwRAAAAAoCptttlmxQTbcp588sliku4XrbTSSnHggQcGTduee+5ZPKsvmjdvXq1R94s6depUbAHmX0wBBgAAAKpSy5YtixVigwYNWuI906ZNi8cffzz222+/xa4fdthhccMNN1TcSrokKTKdc845QWUjRoyIe++9t17vSeGvtq3af/rTn4pnWk6a9Jz+NvgXARAAAACoWvvvv3/cd9998dlnny3xnv/+7/+OfffdN1q0aPF/19Zff/0iHqYVgksjrTw85phjgsruv//+egfAtE07rfCsKUXbSg499NBgcbYAAwAAAFWrb9++0bNnz7L3jBo1Kt54442S68cff3wxTISm5+STTy659vbbb8crr7xS9n09evSIXXfdNVicAAgAAABUrbZt28Yuu+xS9p45c+bEQw89VHJ9++23j969ewdNSzq/b5tttim5nrZ6V9qynQbDiLqlBEAAAACgqqWBHjWHRdR0yy23xOTJkxe7lkLR+eefHzQtP/rRj0oi3oQJE4pnWE76Gzj44IODUgIgAAAAUNXSWXE777xz2XtmzZoVt912W8n1tF20f//+QdOQnkVamVnT7bffXjzDcnbaaafYaqutglLWRAIAAABVbdVVVy2GgQwePLjsfQMHDowTTzwx2rdvv9j10047LV5++eV6TQReuHBhjBkzJqhs/PjxdbovreD7zne+U3J9+vTpZSc9/9Mhhxyy2KAX/qXFZ+XG5DQRtT28KvixAQAAgOVkwYIFxdlxU6dOLXvfmWeeGeeee27J9W9961vxyCOPBCvO3nvvHTfddFNJB0rXLrnkkrLvTVOZhw4dWpwJuTxVS7OyBRgAAACoeunMuBTxKvn9738f48aNK7n+gx/8INZYY41gxWjXrl1ceumlJUFt0qRJce2111Z8/+mnn77c4181EQABAACALBx55JHRtWvXsvekoJS2AtfUs2fPOOWUU4LlL0W/s88+O7p161by2m9+85tiC3A56X1pEAxLJgACAAAAWejcuXMccMABFe+78cYb44033ii5/u1vf9sQiRVgu+22i+OPP77k+ujRo4tnVUk6/zE9e5ZMAAQAAACycdxxx8Waa65Z9p50XuAFF1xQ61ltv/jFL2K11VYLlo+0YvPKK6+Mli1bLnY9PZv/+q//Kp5VOd27d681HrI4ARAAAADIxtprrx2nnnpqxfvS1N+bb7655PqGG24YF198sWmyy0na+rvxxhuXXE/PZsiQIRXff9JJJ0WPHj2C8kwBBgAAALKSVo317ds3JkyYUPa+NPTj8ccfj3XWWafktXQe4EMPPRQ0nkMPPTSuueaakutpSMsee+wRU6ZMKfv+tHrw+eefX6ErNk0BBgAAAFgB0kTgukyO/fTTT5e4WjBtBU4Rkcax+eabF1t/a5o3b16ceOKJFeNfkt5vu3bdCIAAAABAdgYMGBC77rprxfuGDRsW119/fcn1lVdeuYiA6667btCw0mf661//ugi1Nd10003xt7/9reL3SM83rRKkbmwBBgAAALI0fPjwYpvpzJkzy96XusN9990X/fr1K3ktxagjjjiiTivSqKxt27bx6KOPRq9evUpeS+cyHnnkkTFr1qyy3yOt+nvqqaeaRJy1BRgAAABgBdp6663jvPPOq3hfCjZpK/DYsWNLXttyyy3j1ltvrXW1GvXTvn37uP/++2uNfx988EEx0KNS/Eu+973vWZlZTwIgAAAAkK3jjjsuttlmm4r3jR8/Pk4++eSYPXt2yWvbb7993HLLLcXQCZZO+uyuuuqq4uy/miZOnFic+5f+W8m2224bhx9+eFA/AiAAAACQrbRF8+qrr45OnTpVvHfkyJFx/vnn17qFc/fdd48f//jH0aFDh6B+0urJ9Ay+8Y1vlLy2aNGiuOyyy4rPvpK0fTidy5j+S/0IgAAAAEDW0pbTiy66qE73Dho0KH7wgx/U+loKWHfffXe0bt06qJsUXu+9997Ybbfdan39wgsvLD7zSlZaaaUiFK633npB/QmAAAAAQPYOPvjgOm8dHThwYBGbarPFFlvEY489Fj179gzKS59R2jqdtlDXtGDBgrj00kuLz7oujj322OIZsnQEQAAAACB7aStwWgWYBoPUxQ033BA33nhjEapq2mSTTeLOO++s9Tw7Pte3b9+45557ao1/yc033xw33XRT1MWGG24Y5557bq0Td6mbFp81xdnENVTLSGUAAACgafvoo49iv/32K6bO1kUaDLKk7cPz588vzgxM24J1is+lhvP1r389rrvuuiVOTk6rK1Ncrctn1r1792LFZbdu3aIpqpZmJQACAAAAzcrQoUOL7aTz5s2r0/1pkvAll1yyxBVod9xxR/zoRz+KWbNmRXOWhnP88Ic/jCOPPLLW11PLueCCC+J3v/td1EW7du3i9ttvL1YTNlXV0qxsAQYAAACalRSUfvazn0XLli3rdP+tt94aZ511VkycOLHW14844oh44oknol+/ftFcbbXVVsVnsKT4N3v27OIzrGv8S0M/fvKTnzTp+FdNrAAEAAAAmqW0uuy8886r8/3pzL/f/va3sc4669T6+sKFC4uhF9dcc03MmDEjmoM11lgjTjnllPj2t7+9xHvGjh1bbKUeOXJk1NXll18eRx99dDR1tgA3IAEQAAAAaAzXX399EZvqqkuXLkUE3G677ZZ4z/jx4+Piiy+Oxx9/PBYtWhQ5Sq1mr732igsvvLDsROQXX3wxTj311Pj444+jrn784x/HCSecENVAAGxAAiAAAADQWK6++uq49tpr63x/OuvutNNOK1a1rbLKKrXek7rF4MGD41e/+lURwXLSv3//OP3002OXXXYpe1+Kqz//+c/rdTZi2iZ8zjnnRLUQABuQAAgAAAA0pnQmYPqqT2/YaaedinDYo0ePsvc9+eSTxfd+7bXXolqlib69e/cutvvuu+++Ze9NE5ZTxBsyZEjUVWo/Kf6dffbZUU0EwAYkAAIAAACNLQ2o+MEPflCvbbsdO3aMM888s9iyuqQpwcmCBQti+PDhceONN8ZTTz1VNVuD0zCOPfbYI44//vjYfvvtixC4JKnVpDMQf/nLX8akSZOirtIwliuuuKIYplJtBMAGJAACAAAAy8ODDz4Y3//+9+s1xCN1i3Qm4CWXXBKbbrppxftHjRoVjzzySLEycMyYMdEUdevWLQ488MA47LDDYv311694/5tvvhnnn39+vPzyy1EfaTv1lVdeGQcccEBUIwGwAQmAAAAAwPIydOjQYqrtRx99VK/3pdVx6VzAk046KTp37lzx/jQ1+Jlnnili4PPPPx8TJkxYYb0jtZcU/XbYYYfYZ599ilV/afVfJePGjYuBAwcWKxvTKsf6WHvttYtzAvv27RvVSgBsQAIgAAAAsDylGJdWwL399ttRX+3bty/Os0ur5zp06FCn98ydOzdef/31ePrpp+NPf/pTjB49OubPnx+NKfWWXr16xX777VcM9Pjyl78cq666ap3em7Ywp+iXvuqz3fef+vTpU4TDtdZaK6qZANiABEAAAABgeZs2bVoxIfi2225bqjP7evbsGQcddFAceeSR0bVr13q9N03O/fvf/14EyBEjRsS7774b48ePj/feey9mz55dr++VJhV379692Mq78cYbx7rrrhubbbZZ8dW6det6fa/JkycXn0eKdxMnToylcfjhh8dFF11U5zjalAmADUgABAAAAFaUu+++uwhWKcotjTZt2sTRRx9drAjcaKONYll98skn8f777xerFKdOnRpz5sz5v+23aRtyWsWXhpOk6JgmFKetveUGlFSSGkxanfjwww8XQz6W9nPo1KlTXHjhhXHIIYcs08/TlAiADUgABAAAAFaktAIvTftN5wMurXSm3jbbbFOcL7jrrrvWebvtipK2JT/++OPFir/XXnutCI1LK/3eP/3pT2OTTTaJnAiADUgABAAAAFa0tPLtrrvuKqbWzpw5M5ZF2v664447xv777x/bb799dOnSJZqCtK332WefjRdffDGeeOKJYhv0slhttdXie9/7Xhx//PHZrPr7IgGwAQmAAAAAQFORtsNedtll8dxzz8WySs0jbY3ddttto3///rHddtsVZ/WtvvrqsTykLcT/+Mc/Yvjw4cUk4lGjRhVnDTZEd0mrHNOqyWqe8luJANiABEAAAACgKUld4qmnnipWt6Uz+RpSWh2YIuDmm28e/fr1KwZ3bLDBBsVZgssiDQ9JZwe++uqrMWzYsGJbb9raPH369AbtLOnswWuvvTYGDBiQ5aq/LxIAG5AACAAAADRFM2bMiDvuuKMYjvHhhx9GY0ltJG0TXnPNNYuvFAnTKsF27doVU35btmxZ3LNw4cLi7L60XTn9bJMmTSqGhaSfraFDX03p5zr11FPj2GOPLYaRNAcCYAMSAAEAAICmLJ2dd8MNN8QDDzxQBLfmJE0Z3m+//Ypz/tZee+1oTgTABiQAAgAAANUgrbhLqwEHDhwYU6ZMiZylFYgnnXRSHHnkkU1miMnyJgA2IAEQAAAAqCZpC+6TTz4ZgwYNiiFDhsSiRYsiByuttFLsvPPOxfTi9NVctvouiQDYgARAAAAAoBqlfpEm7P7hD3+IJ554IsaNGxfVJnWZnj17xi677BIHHnhgbLbZZrHqqqsGAmCDEgABAACAardgwYIYPHhw3HXXXfHSSy/F5MmToynr2LFj7LnnnsX5fn379o22bdsGixMAG5AACAAAAOQkTesdOXJkvPjii/Hwww/HmDFjYs6cObEitW7dOjbaaKMi+g0YMCC22mqrYrowSyYANiABEAAAAMhVahwff/xxvPHGGzFixIgYPXp0vPnmm/HRRx8VZwk2dANJnSUN8FhzzTVj4403jj59+sSWW24ZvXv3LoZ5NPdz/epDAGxAAiAAAADQ3EyfPr04M/C1116Lt956q/jfacrwp59+GjNmzCheT4Fw/vz5xfbiJA3pSOfzpdV8q622WnTq1CnWWGON6N69exH8evXqFf/2b/8W3bp1K7b41tZcqDsBsAEJgAAAAAA0NdXSrFYKAAAAACBbAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJCxVlGlWrRoEQAAAABAeVYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGNVMQTks88+CwAAAACg/qwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIwJgAAAAACQMQEQAAAAADImAAIAAABAxgRAAAAAAMiYAAgAAAAAGRMAAQAAACBjAiAAAAAAZEwABAAAAICMCYAAAAAAkDEBEAAAAAAyJgACAAAAQMYEQAAAAADImAAIAAAAABkTAAEAAAAgYwIgAAAAAGRMAAQAAACAjAmAAAAAAJAxARAAAAAAMiYAAgAAAEDGBEAAAAAAyJgACAAAAAAZEwABAAAAIGMCIAAAAABkTAAEAAAAgIz9f13ZWbtxTOxJAAAAAElFTkSuQmCC"
                        .toByteArray()
                )
            )
        )

        private const val WIDTH = 1280
        private const val HEIGHT = 640
        private const val MAX_ABSTRACT_ROW_WIDTH = 1000

        private val TITLE_FONT = Font("Baskerville", 1, 72)
        private val TITLE_COLOR = Color.BLACK!!

        private val ABSTRACT_FONT = Font("Helvetica Neue", 3, 42)
        private val ABSTRACT_COLOR = Color.LIGHT_GRAY!!

        // MARK: - Internal helper methods -

        /**
         * Generates a preview image from given post configuration
         *
         * @param postConfiguration Given configuration
         * @param outputDirectoryName Output directy name
         */
        fun generate(postConfiguration: PostConfiguration, outputDirectoryName: String) {

            // Create canvas
            val image = BufferedImage(
                WIDTH,
                HEIGHT,
                BufferedImage.TYPE_INT_ARGB
            )

            // Create image with background
            val graphics = image.createGraphics()
            graphics.drawImage(BACKGROUND_IMAGE, 0, 0, null)

            // Add title
            graphics.font = TITLE_FONT
            graphics.color = TITLE_COLOR
            val titleLines = wrap(postConfiguration.title, graphics.fontMetrics).take(2)
            for ((index, value) in titleLines.withIndex()) {
                graphics.drawString(value, 100, 140 + (index * 88))
            }

            // Add abstract
            graphics.font = ABSTRACT_FONT
            graphics.color = ABSTRACT_COLOR
            val abstractLines = wrap(postConfiguration.abstract, graphics.fontMetrics).take(3)
            for ((index, value) in abstractLines.withIndex()) {
                graphics.drawString(value, 100, 140 + (index * 60) + (titleLines.count() * 88))
            }

            // Write file
            ImageIO.write(image, "PNG", File(File("./$outputDirectoryName"), "${postConfiguration.filename}.png"))
        }

        // MARK: - Private helper -

        /**
         * Based on:
         * https://stackoverflow.com/questions/12129633/how-do-i-render-wrapped-text-on-an-image-in-java
         */
        private fun wrap(txt: String, fm: FontMetrics): List<String> {
            val st = StringTokenizer(txt)
            val list: MutableList<String> = ArrayList()
            var line = ""
            var lineBeforeAppend = ""
            while (st.hasMoreTokens()) {
                val seg = st.nextToken()
                lineBeforeAppend = line
                line += "$seg "
                val width = fm.stringWidth(line)
                line = if (width < MAX_ABSTRACT_ROW_WIDTH) {
                    continue
                } else { //new Line.
                    list.add(lineBeforeAppend)
                    "$seg "
                }
            }
            //the remaining part.
            if (line.isNotEmpty()) {
                list.add(line)
            }
            return list
        }
    }
}


